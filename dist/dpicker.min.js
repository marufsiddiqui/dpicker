!function(e,t){"function"==typeof define&&define.amd?define("DPicker",["moment","maquette"],t):"object"==typeof module&&module.exports?module.exports=t(require("moment"),require("maquette")):e.DPicker=t(e.moment,e.maquette)}(this,function(e,t){"use strict";function n(){}function r(e){return function(t,n,r){return function(){return e(t,n,r)}}}function a(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^16*Math.random()>>e/4).toString(16)})}function i(e){return[].findIndex.call(e.parentNode.children,function(t){return t==e})}function o(n){var r=this,d=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(this instanceof o))return new o(n,d);this._container=a();var u=d.model||e();this._data={model:u.clone(),format:d.format||"DD/MM/YYYY",display:d.display||!1,futureYear:d.futureYear||+u.format("YYYY")+1,pastYear:d.pastYear||1986,months:d.months||e.months(),inputId:d.inputId||a(),inputName:d.name||"dpicker-input",isEmpty:void 0!==d.model&&!d.model,onChange:d.onChange},this._projector=t.createProjector(),this._events={hide:function(e){if(0!=r._data.display){for(var t=e.target,n=t.parentNode;n&&n!=document;){if(n.getAttribute("id")==r._container)return;n=n.parentNode}r._data.display=!1,r._projector.scheduleRender(),r._data.onChange&&r._data.onChange(r._data,["display"])}},inputChange:function(t){if(t.target.value){var n=e(t.target.value,r._data.format);n.isValid()&&(r._data.model=n),r._data.isEmpty=!1}else r._data.isEmpty=!0;r._data.onChange&&r._data.onChange(r._data,["model"])},inputFocus:function(e){r._data.display=!0,r._data.onChange&&r._data.onChange(r._data,["display"])},yearChange:function(e){r._data.isEmpty=!1,r._data.model.year(e.target.options[e.target.selectedIndex].value),r._data.onChange&&r._data.onChange(r._data,["model"])},monthChange:function(e){r._data.isEmpty=!1,r._data.model.month(e.target.options[e.target.selectedIndex].value),r._data.onChange&&r._data.onChange(r._data,["model"])},dayClick:function(e){e.preventDefault(),r._data.model.date(e.target.value),r._data.isEmpty=!1,r._data.onChange&&r._data.onChange(r._data,["model"])},dayKeyDown:function(e){var t=e.which||e.keyCode;if(!(t>40||t<37)){var n=e.target.parentNode,r=n.parentNode.parentNode;switch(t){case 37:var a=n.previousElementSibling;if(a&&a.querySelector("button"))return a.querySelector("button").focus();if(a=n.parentNode.previousElementSibling,a=a?a.querySelector("td:last-child button"):null)return a.focus();var o=r.querySelector("tr:last-child").querySelectorAll("td.dpicker-active");return o[o.length-1].querySelector("button").focus();case 39:var d=n.nextElementSibling;return d&&d.querySelector("button")?d.querySelector("button").focus():(d=n.parentNode.nextElementSibling,d=d?d.querySelector("td:first-child button"):null,d?d.focus():r.querySelector("tr:first-child").nextElementSibling.querySelectorAll("td.dpicker-active")[0].querySelector("button").focus());case 38:var u=i(n),c=n.parentNode.previousElementSibling;if(c=c?c.children[u]:null,c&&c.classList.contains("dpicker-active"))return c.querySelector("button").focus();for(var s=r.querySelector("tr:last-child");s;){if(s.children[u].classList.contains("dpicker-active"))return s.children[u].querySelector("button").focus();s=s.previousElementSibling}case 40:var l=i(n),p=n.parentNode.nextElementSibling;if(p=p?p.children[l]:null,p&&p.classList.contains("dpicker-active"))return p.querySelector("button").focus();for(var h=r.querySelector("tr:first-child");h;){if(h.children[l].classList.contains("dpicker-active"))return h.children[l].querySelector("button").focus();h=h.nextElementSibling}}}}},document.addEventListener("click",this._events.hide);var c=this.render(this._events,this._data,[this.renderYears(this._events,this._data),this.renderMonths(this._events,this._data),this.renderDays(this._events,this._data)]);if("INPUT"==n.tagName){if(!n.parentNode)throw new ReferenceError("Can not init DPicker on an input without parent node");return this._projector.merge(n,this.renderInput(this._events,this._data)),n.parentNode.setAttribute("id",this._container),n.parentNode.classList.add("dpicker"),this._projector.append(n.parentNode,c),this}return this._projector.append(n,this.renderContainer(this._events,this._data,[this.renderInput(this._events,this._data),c])),n.setAttribute("id",this._container),this}var d=t.h;return o.prototype.renderInput=r(function(e,t,n){return d("input#"+t.inputId,{value:t.isEmpty?"":t.model.format(t.format),type:"text",onchange:e.inputChange,onfocus:e.inputFocus,name:t.inputName})}),o.prototype.renderContainer=r(function(e,t,n){return d("div.dpicker",n.map(function(e){return e()}))}),o.prototype.render=r(function(e,t,n){return d("div.dpicker-container",{classes:{"dpicker-visible":t.display,"dpicker-invisible":!t.display}},n.map(function(e){return e()}))}),o.prototype.renderYears=r(function(e,t,n){for(var r=+t.model.format("YYYY"),a=t.futureYear+1,i=[];--a>=t.pastYear;)i.push(d("option",{value:a,selected:a===r},""+a));return d("select",{onchange:e.yearChange,name:"dpicker-year"},i)}),o.prototype.renderMonths=r(function(e,t,n){var r=+t.model.format("MM");return d("select",{onchange:e.monthChange,name:"dpicker-month"},t.months.map(function(e,t){return d("option",{value:t,selected:t+1===r},e)}))}),o.prototype.renderDays=r(function(t,r,a){var i=r.model.daysInMonth(),o=r.model.clone().subtract(1,"months").daysInMonth(),u=+r.model.clone().date(1).format("e")-1,c=r.model.date(),s=new Array(Math.ceil(.1+(u+i)/7)).fill(0),l=void 0,p=void 0;return d("table",[d("tr",e.weekdaysShort().map(function(e){return d("th",e)})),s.map(function(e,r){return d("tr",{key:r},new Array(7).fill(0).map(function(e,a){return a<=u&&0==r?(l=o-(u-a),p=!1):a==u+1&&0==r?(l=1,p=!0):(l==i&&(l=0,p=!1),l++),d("td",{classes:{"dpicker-active":p,"dpicker-inactive":!p}},[d(p?"button":"span",{onclick:p?t.dayClick:n,value:l,type:"button",onkeydown:t.dayKeyDown,classes:{"dpicker-active":c==l}},l)])}))})])}),Object.defineProperty(o.prototype,"container",{get:function(){return this._container}}),Object.defineProperty(o.prototype,"inputId",{get:function(){return this._data.inputId}}),["model","format","display","futureYear","pastYear","months","onChange"].forEach(function(e){Object.defineProperty(o.prototype,e,{get:function(){return this._data[e]},set:function(t){"model"===e?(this._data.isEmpty=!t,this._data[e]=t?t:this._data[e]):this._data[e]=t,"onChange"!=e&&this._projector.scheduleRender()}})}),o});