!function(t,e){"function"==typeof define&&define.amd?define("DPicker",["moment","maquette"],e):"object"==typeof module&&module.exports?module.exports=e(require("moment"),require("maquette")):t.DPicker=e(t.moment,t.maquette)}(this,function(t,e){"use strict";function n(){}function a(t){return function(e,n,a){return function(){return t(e,n,a)}}}function r(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})}function o(n){var a=this,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this._container=r();var i=o.model||t();this._data={model:i.clone(),format:o.format||"DD/MM/YYYY",display:o.display||!1,futureYear:o.futureYear||+i.format("YYYY")+1,pastYear:o.pastYear||1986,months:o.months||t.months(),inputId:o.inputId||r(),inputName:o.name||"dpicker-input"},this._projector=e.createProjector(),this._events={hide:function(t){if(0!=a._data.display){for(var e=t.target,n=e.parentNode;n&&n!=document;){if(n.getAttribute("id")==a._container)return;n=n.parentNode}a._data.display=!1,a._projector.scheduleRender(),o.onChange&&o.onChange(a._data,["display"])}},inputChange:function(e){e.target.value?(a._data.isEmpty=!1,a._data.model=t(e.target.value,a._data.format)):a._data.isEmpty=!0,o.onChange&&o.onChange(a._data,["model"])},inputFocus:function(t){a._data.display=!0,o.onChange&&o.onChange(a._data,["display"])},yearChange:function(t){a._data.isEmpty=!1,a._data.model.year(t.target.options[t.target.selectedIndex].value),o.onChange&&o.onChange(a._data,["model"])},monthChange:function(t){a._data.isEmpty=!1,a._data.model.month(t.target.options[t.target.selectedIndex].value),o.onChange&&o.onChange(a._data,["model"])},dayClick:function(t){a._data.isEmpty=!1,a._data.model.date(t.target.value),o.onChange&&o.onChange(a._data,["model"])}},document.addEventListener("click",this._events.hide);var d=this.render(this._events,this._data,[this.renderYears(this._events,this._data),this.renderMonths(this._events,this._data),this.renderDays(this._events,this._data)]);return"INPUT"==n.tagName?(this._projector.merge(n,this.renderInput(this._events,this._data)),n.parentNode.setAttribute("id",this._container),n.parentNode.classList.add("dpicker"),this._projector.append(n.parentNode,d),this):(this._projector.append(n,this.renderContainer(this._events,this._data,[this.renderInput(this._events,this._data),d])),n.setAttribute("id",this._container),this)}var i=e.h;return o.prototype.renderInput=a(function(t,e,n){return i("input#"+e.inputId,{value:e.isEmpty?"":e.model.format(e.format),type:"text",onchange:t.inputChange,onfocus:t.inputFocus,name:e.inputName})}),o.prototype.renderContainer=a(function(t,e,n){return i("div.dpicker",n.map(function(t){return t()}))}),o.prototype.render=a(function(t,e,n){return i("div.dpicker-container",{classes:{"dpicker-visible":e.display,"dpicker-invisible":!e.display}},n.map(function(t){return t()}))}),o.prototype.renderYears=a(function(t,e,n){for(var a=+e.model.format("YYYY"),r=e.futureYear+1,o=[];--r>=e.pastYear;)o.push(i("option",{value:r,selected:r===a},""+r));return i("select",{onchange:t.yearChange,name:"dpicker-year"},o)}),o.prototype.renderMonths=a(function(t,e,n){var a=+e.model.format("MM");return i("select",{onchange:t.monthChange,name:"dpicker-month"},e.months.map(function(t,e){return i("option",{value:e,selected:e+1===a},t)}))}),o.prototype.renderDays=a(function(e,a,r){var o=a.model.daysInMonth(),d=a.model.clone().subtract(1,"months").daysInMonth(),s=+a.model.clone().date(1).format("e")-1,u=a.model.date(),c=new Array(Math.ceil(.1+(s+o)/7)).fill(0),p=void 0,h=void 0;return i("table",[i("tr",t.weekdaysShort().map(function(t){return i("th",t)})),c.map(function(t,a){return i("tr",{key:a},new Array(7).fill(0).map(function(t,r){return s>=r&&0==a?(p=d-(s-r),h=!1):r==s+1&&0==a?(p=1,h=!0):(p==o&&(p=0,h=!1),p++),i("td",{classes:{"dpicker-active":h,"dpicker-inactive":!h}},[i(h?"button":"span",{onclick:h?e.dayClick:n,value:p,classes:{"dpicker-active":u==p}},p)])}))})])}),Object.defineProperty(o.prototype,"container",{get:function(){return this._container}}),Object.defineProperty(o.prototype,"inputId",{get:function(){return this._data.inputId}}),["model","format","display","futureYear","pastYear","months"].forEach(function(t){Object.defineProperty(o.prototype,t,{get:function(){return this._data[t]},set:function(e){"model"!==t||e?this._data[t]=e:this._data.isEmpty=!0,this._projector.scheduleRender()}})}),o});