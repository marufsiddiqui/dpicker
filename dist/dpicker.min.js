!function(e,t){"function"==typeof define&&define.amd?define("DPicker",["moment","maquette"],t):"object"==typeof module&&module.exports?module.exports=t(require("moment"),require("maquette")):e.DPicker=t(e.moment,e.maquette)}(this,function(e,t){"use strict";function n(){}function a(e){return function(t,n,a){return function(){return e(t,n,a)}}}function r(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^16*Math.random()>>e/4).toString(16)})}function o(n){var a=this,o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this._container=r();var i=o.moment||e();return this._data={model:i.clone(),format:o.format||"DD/MM/YYYY",display:o.display||!1,futureYear:o.futureYear||+i.format("YYYY")+1,pastYear:o.pastYear||1986,months:o.months||e.months(),inputId:o.inputId||r()},this._projector=t.createProjector(),this._events={hide:function(e){for(var t=e.target,n=t.parentNode;n!=document;){if(n.getAttribute("id")==a._container)return;n=n.parentNode}a._data.display=!1,a._projector.scheduleRender(),o.onChange&&o.onChange(a._data,["display"])},inputChange:function(t){a._data.model=e(t.target.value,a._data.format),o.onChange&&o.onChange(a._data,["model"])},inputFocus:function(e){a._data.display=!0,o.onChange&&o.onChange(a._data,["display"])},yearChange:function(e){a._data.model.year(e.target.options[e.target.selectedIndex].value),o.onChange&&o.onChange(a._data,["model"])},monthChange:function(e){a._data.model.month(e.target.options[e.target.selectedIndex].value),o.onChange&&o.onChange(a._data,["model"])},dayClick:function(e){a._data.model.date(e.target.value),o.onChange&&o.onChange(a._data,["model"])}},document.addEventListener("click",this._events.hide),n.setAttribute("id",this._container),this._projector.append(n,this.render(this._events,this._data,[this.renderYears(this._events,this._data),this.renderMonths(this._events,this._data),this.renderDays(this._events,this._data)])),this}var i=t.h;return o.prototype.render=a(function(e,t,n){return i("div.dpicker",[i("input#"+t.inputId,{value:t.model.format(t.format),type:"text",onchange:e.inputChange,onfocus:e.inputFocus,name:"dpicker-input"}),i("div.dpicker-container",{classes:{"dpicker-visible":t.display,"dpicker-invisible":!t.display}},n.map(function(e){return e()}))])}),o.prototype.renderYears=a(function(e,t,n){for(var a=+t.model.format("YYYY"),r=t.futureYear+1,o=[];--r>=t.pastYear;)o.push(i("option",{value:r,selected:r===a},""+r));return i("select",{onchange:e.yearChange,name:"dpicker-year"},[o])}),o.prototype.renderMonths=a(function(e,t,n){var a=+t.model.format("MM");return i("select",{onchange:e.monthChange,name:"dpicker-month"},t.months.map(function(e,t){return i("option",{value:t,selected:t+1===a},e)}))}),o.prototype.renderDays=a(function(t,a,r){var o=a.model.daysInMonth(),d=a.model.clone().subtract(1,"months").daysInMonth(),u=+a.model.clone().date(1).format("e")-1,s=a.model.date(),c=new Array(Math.ceil(.1+(u+o)/7)).fill(0),p=void 0,h=void 0;return i("table",[i("tr",e.weekdaysShort().map(function(e){return i("th",e)})),c.map(function(e,a){return i("tr",{key:a},new Array(7).fill(0).map(function(e,r){return u>=r&&0==a?(p=d-(u-r),h=!1):r==u+1&&0==a?(p=1,h=!0):(p==o&&(p=0,h=!1),p++),i("td",{classes:{"dpicker-active":h,"dpicker-inactive":!h}},[i(h?"button":"span",{onclick:h?t.dayClick:n,value:p,classes:{"dpicker-active":s==p}},p)])}))})])}),Object.defineProperty(o.prototype,"container",{get:function(){return this._container}}),Object.defineProperty(o.prototype,"inputId",{get:function(){return this._data.inputId}}),["model","format","display","futureYear","pastYear","months"].forEach(function(e){Object.defineProperty(o.prototype,e,{get:function(){return this._data[e]},set:function(t){this._data[e]=t,this._projector.scheduleRender()}})}),o});